<!-- /auth.html -->
<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Giriş • Takas Çemberi</title>
  <style>
    :root{--ink:#0f172a}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:#f7fafc;display:grid;place-items:center;color:var(--ink)}
    .card{width:min(420px,92vw);background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
    h1{margin:0 0 10px}
    p{margin:0 0 16px;color:#64748b}
    .btn{width:100%;display:block;padding:12px 14px;border-radius:10px;border:1px solid #111827;background:#111827;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div class="card">
    <h1>Giriş yap</h1>
    <p>Google ile hızlı giriş yapabilirsiniz.</p>
    <button id="btnGoogle" class="btn" type="button">Google ile Giriş</button>
  </div>

  <!-- Firebase init (senin mevcut dosyan) -->
  <script type="module" src="assets/js/firebase-init.js"></script>

  <!-- Sadece bu sayfaya özel giriş mantığı -->
  <script type="module">
    import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    /* GitHub Pages uyumlu BASE hesaplama (kendi domain'inde otomatik / olur) */
    const REPO = location.hostname.endsWith('github.io') ? location.pathname.split('/')[1] : '';
    const BASE = REPO ? `/${REPO}/` : '/';
    const go   = (p='') => location.href = new URL(p, location.origin + BASE).href;

    const auth = window.__fb?.auth || getAuth();
    const provider = new GoogleAuthProvider();

    function goNext() {
      const next = new URLSearchParams(location.search).get('next');
      // next yoksa anasayfa
      go(next || '');
    }

    // Kullanıcı zaten girişliyse direkt yönlendir
    onAuthStateChanged(auth, async (user)=>{
      if(user){
        try{ await window.__fb?.upsertPublicProfile?.(user); }catch{}
        goNext();
      }
    });

    // Buton: Google ile giriş
    document.getElementById('btnGoogle')?.addEventListener('click', async ()=>{
      try{
        const cred = await signInWithPopup(auth, provider);
        try{ await window.__fb?.upsertPublicProfile?.(cred.user); }catch{}
        goNext();
      }catch(e){
        console.error(e);
        alert('Giriş başarısız: ' + (e.code || e.message || 'hata'));
      }
    });
  </script>
</body>
</html>
