<!doctype html>
<html lang="tr">
<head>
<link rel="icon" type="image/png" href="favicon.png">
<link rel="icon" href="favicon.ico">

<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Takas Çemberi • Ana Sayfa</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#2563eb;
  --secondary:#10b981;
  --accent:#f59e0b;
  --danger:#ef4444;
  --bg:#f7fafc;
  --card:#ffffff;
  --ring:#e5e7eb;
  --text:#111827;
  --muted:#6b7280;
}
*{box-sizing:border-box}
body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden}
.wrap{max-width:1200px;margin:0 auto;padding:16px}

/* NAV */
.topnav{position:sticky;top:0;z-index:40;background:#fff;border-bottom:1px solid var(--ring)}
.topnav-in{display:flex;align-items:center;gap:14px;padding:10px 0;position:relative}
.brand img{height:57px}
.search input{width:300px;max-width:40vw;padding:10px;border-radius:8px;border:1px solid var(--ring)}
.navlinks{margin-left:auto;display:flex;gap:8px}
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 14px;border-radius:8px;font-weight:600;text-decoration:none;transition:.2s}
.btn:hover{opacity:.9}
.btn.home{background:linear-gradient(90deg,#3b82f6,#60a5fa);color:#fff}
.btn.msg{background:linear-gradient(90deg,#10b981,#34d399);color:#fff}
.btn.notif{background:linear-gradient(90deg,#f59e0b,#fbbf24);color:#fff}
.btn.add{background:linear-gradient(90deg,#6366f1,#8b5cf6);color:#fff}
.btn.profile{background:linear-gradient(90deg,#ec4899,#f472b6);color:#fff}
.btn.logout{background:linear-gradient(90deg,#ef4444,#f87171);color:#fff}

/* MOBILE-ONLY header actions */
.mobile-actions{display:none;gap:8px;align-items:center;margin-left:auto}
.mobile-username{display:none;font-weight:700}
.avatar-btn{display:none; width:40px;height:40px;border-radius:999px;border:1px solid var(--ring);background:#fff;box-shadow:0 4px 10px rgba(0,0,0,.08);cursor:pointer}
.mobmenu{display:none;position:absolute;right:8px;top:64px;background:#fff;border:1px solid var(--ring);border-radius:12px;box-shadow:0 18px 40px rgba(0,0,0,.16);min-width:200px;z-index:60}
.mobmenu .item{display:block;padding:10px 12px;text-decoration:none;color:var(--text);border-bottom:1px solid #f1f5f9}
.mobmenu .item:last-child{border-bottom:none}
.mobmenu .item strong{display:block;color:#0f172a}

/* HERO */
.hero{position:relative;overflow:hidden;padding:64px 20px;text-align:center;background:linear-gradient(135deg,#e0f2fe,#ecfdf5)}
.hero h1,.hero h2,.hero p{margin:0;line-height:1.3}
.hero h1{font-size:46px;font-weight:900;margin-bottom:10px;
  background:linear-gradient(90deg,#2563eb,#22c55e,#f59e0b,#ec4899);-webkit-background-clip:text;background-clip:text;color:transparent;
  animation:grad 6s linear infinite;background-size:400% 400%}
.hero h2{font-size:28px;font-weight:600;margin-bottom:10px;
  background:linear-gradient(90deg,#10b981,#3b82f6,#f43f5e,#f59e0b);-webkit-background-clip:text;background-clip:text;color:transparent;
  animation:grad 8s linear infinite;background-size:400% 400%}
.hero p{font-size:20px;font-weight:500;
  background:linear-gradient(90deg,#f472b6,#2563eb,#22c55e,#f59e0b);-webkit-background-clip:text;background-clip:text;color:transparent;
  animation:grad 10s linear infinite;background-size:400% 400%}
.hero .cta{margin-top:22px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
.hero .cta a{padding:12px 20px;border-radius:8px;font-weight:700;text-decoration:none}
.hero .cta .start{background:var(--primary);color:#fff}

@keyframes grad{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

/* CATEGORY CARDS */
.cat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin:40px 0}
.cat-card{position:relative;isolation:isolate;border-radius:14px;padding:20px;text-align:center;border:1px solid var(--ring);overflow:hidden;transition:.2s;color:#fff}
.cat-card .ico{font-size:32px;margin-bottom:10px;position:relative;z-index:1}
.cat-card h3{margin:0;font-size:18px;position:relative;z-index:1}
.cat-card p{margin:6px 0 0;font-size:14px;position:relative;z-index:1;opacity:.9}
.cat-card::before{content:"";position:absolute;inset:0;z-index:0;opacity:1;background:linear-gradient(135deg,#3b82f6,#8b5cf6,#10b981,#f59e0b);background-size:300% 300%;animation:grad 10s ease infinite}
.cat-card:hover{transform:translateY(-4px);box-shadow:0 10px 24px rgba(0,0,0,.15)}

/* FEED */
.feed{margin:60px 0}
.feed h2{margin-bottom:20px}
.feed p{color:var(--muted)}

/* INFO SECTION */
.info{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:24px;margin:60px 0}
.info-card{position:relative;overflow:hidden;border-radius:14px;color:#fff}
.info-card .in{position:relative;z-index:1;padding:20px}
.info-card h3{margin:0 0 10px}
.info-card p{margin:0}
.info-card::before{content:"";position:absolute;inset:0;z-index:0;background:linear-gradient(135deg,#2563eb,#10b981,#f59e0b,#ec4899);background-size:300% 300%;animation:grad 12s ease infinite;opacity:.95;border-radius:14px}

/* FOOTER (renkli kutular) */
footer{background:#fff;border-top:1px solid var(--ring);margin-top:60px}
footer .wrap{padding:24px}
.footer-cols{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px}
.footer-box{border-radius:12px;padding:16px;color:#fff}
.footer-box h3{margin:0 0 10px}
.footer-box ul{margin:0;padding-left:20px;font-size:14px}
.footer-box.kvkk{background:linear-gradient(135deg,#3b82f6,#60a5fa)}
.footer-box.gizlilik{background:linear-gradient(135deg,#10b981,#34d399)}
.footer-box.guvenlik{background:linear-gradient(135deg,#f59e0b,#fbbf24)}
.footer-box.ssl{background:linear-gradient(135deg,#6366f1,#8b5cf6)}
.footer-box.kullanim{background:linear-gradient(135deg,#ec4899,#f472b6)}

/* CHAT FAB */
.chatfab{position:fixed;right:20px;bottom:20px;display:flex;flex-direction:column;align-items:flex-end;gap:8px;z-index:60}
.fab{position:relative;width:56px;height:56px;border-radius:50%;border:1px solid var(--ring);background:#fff;color:#111;box-shadow:0 8px 22px rgba(0,0,0,.12);cursor:pointer}
.fab-label{display:none;background:#111827;color:#fff;padding:6px 10px;border-radius:10px;font-size:12px}
.chatwin{position:fixed;right:20px;bottom:86px;width:320px;max-width:92vw;display:none;flex-direction:column;background:#fff;border:1px solid var(--ring);border-radius:14px;box-shadow:0 18px 40px rgba(0,0,0,.15);z-index:60}
.chatwin .hd{padding:10px 12px;border-bottom:1px solid var(--ring);font-weight:700;display:flex;justify-content:space-between;align-items:center}
.chatwin .bd{max-height:260px;overflow:auto;padding:10px 12px}
.chatwin .ft{padding:10px 12px;border-top:1px solid var(--ring);display:flex;gap:8px}
.msg{background:#f3f4f6;border:1px solid var(--ring);padding:8px 10px;border-radius:10px;margin:6px 0}
.msg.me{background:#e0f2fe}
#chatInput{flex:1;padding:10px;border-radius:10px;border:1px solid var(--ring)}
#chatSend{padding:10px 14px;border-radius:10px;border:1px solid var(--ring);background:var(--primary);color:#fff;cursor:pointer}

/* BOTTOM NAV (mobile only) */
.bottomnav{display:none}

/* ------- MOBILE RULES ------- */
@media (max-width: 768px){
  body{padding-bottom:76px} /* bottom nav için yer bırak */
  .search{display:none}
  .navlinks{display:none} /* üstteki klasik menüyü gizle */
  .mobile-actions{display:flex}
  .mobile-username{display:inline}
  .avatar-btn{display:inline-flex;align-items:center;justify-content:center}

  /* sağ üstte mobil menü + küçük ilan ekle butonu */
  .mobile-add{display:inline-flex;background:linear-gradient(90deg,#6366f1,#8b5cf6);color:#fff;padding:8px 10px;border-radius:10px;text-decoration:none}

  /* alt menü */
  .bottomnav{position:fixed;left:0;right:0;bottom:0;display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:8px calc(12px + env(safe-area-inset-right)) calc(8px + env(safe-area-inset-bottom)) calc(12px + env(safe-area-inset-left));background:#fff;border-top:1px solid var(--ring);z-index:50}
  .bottomnav a{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;padding:8px 10px;border-radius:10px;text-decoration:none;color:#111}
  .bottomnav a.active{background:#eff6ff}

  /* sadece mobilde mesaj balon rengi değişsin */
  .msg.me{background:#dcfce7;border-color:#bbf7d0}
}
/* ------- MOBILE FIXES APPEND ------- */
@media (max-width: 768px){
  body{padding-bottom:80px}
  html,body{overflow-x:hidden}
  .search{display:none}
  .navlinks{display:none}
  .mobile-actions{display:flex}
  .mobile-username{display:inline}
  .avatar-btn{display:inline-flex;align-items:center;justify-content:center}
  .mobmenu{position:fixed; right:12px; top:56px; max-width:90vw; width:280px; border-radius:12px; overflow:auto}
  .mobile-add{display:inline-flex;background:linear-gradient(90deg,#6366f1,#8b5cf6);color:#fff;padding:8px 10px;border-radius:10px;text-decoration:none}
  .bottomnav{
    position:fixed; left:0; right:0; bottom:0;
    display:flex; justify-content:space-around; align-items:center;
    height:64px;
    padding:0 calc(12px + env(safe-area-inset-right)) calc(6px + env(safe-area-inset-bottom)) calc(12px + env(safe-area-inset-left));
    background:#fff; border-top:1px solid var(--ring); z-index:70;
  }
  .bottomnav a{
    flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;
    gap:2px; padding:8px 6px; border-radius:10px; text-decoration:none; color:#111; white-space:nowrap;
  }
  .bottomnav a.active{background:#eff6ff}
  .bottomnav small{font-size:11px; line-height:1}
  .chatfab{right:16px; bottom:96px; z-index:80}
  .fab{background:#0a1f44; color:#fff; border-color:#0a1f44}
  .chatwin{right:16px; bottom:108px; width:92vw; max-width:360px; z-index:90}
  .msg.me{background:#dcfce7;border-color:#bbf7d0}
}
/* ------- MOBILE OVERRIDES v2 (force) ------- */
@media (max-width:768px){
  html,body{overflow-x:hidden !important;}

  /* Alt bar sabit ve taşmasız */
  .bottomnav{position:fixed !important; left:0 !important; right:0 !important; bottom:0 !important; width:100vw !important; margin:0 !important; transform:none !important; z-index:70 !important;}
  .bottomnav a{min-width:0 !important; white-space:nowrap !important;}

  /* Canlı destek balonu MAVİ ve sağ ikonları kapatmasın diye SOLA alındı */
  .chatfab{left:16px !important; right:auto !important; bottom:96px !important; z-index:80 !important;}
  .fab{background:#2563eb !important; border-color:#2563eb !important; color:#fff !important;}
  .chatwin{left:16px !important; right:auto !important; bottom:110px !important; width:calc(100vw - 32px) !important; max-width:360px !important; z-index:90 !important;}

  /* Mobil dropdown ekran içinde kalsın */
  .mobmenu{position:fixed !important; right:12px !important; left:auto !important; top:56px !important; max-width:90vw !important; width:280px !important;}
}
/* Paylaşılan İlanlar boş mesajı */
#sharedListings + p, #sharedListings + div, #sharedListings ~ .hint {
  text-align:center;
  font-size:clamp(14px, 2vw, 18px);
  color:var(--muted);
  margin:20px auto;
  max-width:90%;
}
.btn.add{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px;font-weight:700;border-radius:12px;text-decoration:none;background:linear-gradient(180deg,#ff3b3b,#d10);color:#fff;box-shadow:0 4px 12px rgba(0,0,0,.2);} .btn.add:hover{opacity:.9;} .btn.add span{font-size:11px;margin-top:2px;} 
.btn.add{min-width:64px;min-height:44px} .btn.add div{font-size:22px;line-height:1} .btn.add:focus-visible{outline:2px solid #fff;outline-offset:2px}  (max-width:640px){.btn.add{padding:8px 10px}.btn.add div{font-size:20px}.btn.add span{font-size:10px}}  (max-width:400px){.btn.add{padding:8px}.btn.add span{display:none}}  (prefers-reduced-motion: reduce){.btn.add{transition:none}} 
/* --- Home: Büyük Yayın Akışı --- */ 
.home-feed{max-width:1200px;margin:16px auto;padding:0 12px}
.home-feed h2{margin:12px 0 8px;font-size:22px;font-weight:800}
.home-feed .grid{display:grid;gap:14px;grid-template-columns:repeat(4,1fr)}
 (max-width:1200px){.home-feed .grid{grid-template-columns:repeat(3,1fr)}}
 (max-width:860px){.home-feed .grid{grid-template-columns:repeat(2,1fr)}}
 (max-width:560px){.home-feed .grid{grid-template-columns:1fr}}
.home-feed .card{border:1px solid #e5e7eb;border-radius:14px;overflow:hidden;background:#fff;box-shadow:0 8px 22px rgba(0,0,0,.06)}
.home-feed .card img{width:100%;height:220px;object-fit:cover;display:block}
.home-feed .meta{padding:12px}
.home-feed .title{font-weight:800}
.home-feed .sub{color:#6b7280;font-size:12px}
.home-feed .actions{display:flex;gap:8px;margin-top:10px}
.home-feed .btn{flex:1;text-align:center;padding:10px 12px;border-radius:10px;background:#0f172a;color:#fff;font-weight:700;text-decoration:none}
 /* --- /Home: Büyük Yayın Akışı --- */ 
/* --- Paylaşılan İlanlar (responsive grid) --- */
.home-share{max-width:1200px;margin:16px auto;padding:0 12px}
.home-share h2{margin:12px 0 8px;font-size:22px;font-weight:800}
.home-share .grid{display:grid;gap:12px;grid-template-columns:repeat(4,minmax(0,1fr))}
 (max-width:1024px){.home-share .grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
 (max-width:600px){.home-share .grid{grid-template-columns:1fr}}
.home-share .card{display:block;border:1px solid #e5e7eb;border-radius:14px;overflow:hidden;background:#fff;text-decoration:none;color:inherit;box-shadow:0 6px 18px rgba(0,0,0,.06)}
.home-share .thumb{width:100%;height:160px;object-fit:cover;display:block}
.home-share .meta{padding:10px}
.home-share .title{font-weight:800;line-height:1.2}
.home-share .sub{color:#6b7280;font-size:12px;margin-top:2px}
/* --- /Paylaşılan İlanlar --- */
</style>
</head>
<body>

<!-- NAV -->
<nav class="topnav">
  <div class="wrap topnav-in">
    <a class="brand" href="home.html"><img src="assets/img/seffaf.png" alt="Takas Çemberi Logo"></a>
    <div class="search"><input id="q" type="search" placeholder="İlanlarda ara..."></div>

    <div class="navlinks">
      <a class="btn home" href="home.html">🏠 Sayfa</a>
      <a class="btn msg" href="messages.html">💬 Mesajlar</a>
      <a class="btn notif nav-bildir" href="#">🔔 Bildirimler</a>
      <a href="profile.html#pending" class="btn add"><div>➕</div><span>İlan Ekle</span></a>
      <a class="btn profile" href="profile.html">👤 Profil</a>
      <a class="btn logout nav-bildir" href="#" data-logout>🚪 Çıkış</a>
    </div>

    <!-- MOBILE actions (sağ üst) -->
    <div class="mobile-actions">
      <a class="mobile-add" href="ilan-ekle.html" aria-label="İlan Ekle">➕</a>
      <span id="mobileUsername" class="mobile-username">@kullanici</span>
      <button class="avatar-btn" id="mobMenuBtn" aria-haspopup="menu" aria-expanded="false">👤</button>
      <div class="mobmenu" id="mobMenu" role="menu" aria-label="Hızlı menü">
        <a class="item" href="profile.html" role="menuitem">👤 Profil</a>
        <a href="ilan-ver.html" class="btn add"><div>➕</div><span>İlan Ekle</span></a>
        <a class="item nav-bildir" href="#" role="menuitem" data-logout>🚪 Çıkış</a>
      </div>
    </div>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <h1>TAKAS ÇEMBERİNE HOŞ GELDİN!</h1>
  <h2>YÜKLE, TAKASLA, KAZAN!</h2>
  <p>Türkiye’nin en güvenilir takas platformunda keşfetmeye hazır mısın?</p>
  <div class="cta">
    <a href="search.html" class="start">🔎 İlan Ara</a>
  </div>
</section>

<!-- CATEGORIES -->
<div class="wrap">
  <h2 id="categories">Kategoriler</h2>
  <div class="cat-grid">
    <a class="cat-card" href="search.html?cat=ev-hobi"><div class="ico">🏠</div><h3>Ev & Hobi</h3><p>Ev eşyaları, hobi ürünleri</p></a>
    <a class="cat-card" href="search.html?cat=tasinmaz"><div class="ico">🏡</div><h3>Taşınmaz</h3><p>Ev, arsa, tarla</p></a>
    <a class="cat-card" href="search.html?cat=tasit"><div class="ico">🚗</div><h3>Motorlu Taşıtlar</h3><p>Araba, motosiklet, yedek parça</p></a>
    <a class="cat-card" href="search.html?cat=oyuncak"><div class="ico">🧸</div><h3>Oyuncak</h3><p>Her yaşa uygun oyuncaklar</p></a>
    <a class="cat-card" href="search.html?cat=giyim"><div class="ico">👗</div><h3>Giyim</h3><p>Kadın, erkek, çocuk</p></a>
    <a class="cat-card" href="search.html?cat=beyaz-esya"><div class="ico">⚡</div><h3>Beyaz Eşya</h3><p>Ev aletleri, mutfak</p></a>
    <a class="cat-card" href="search.html?cat=teknoloji"><div class="ico">💻</div><h3>Teknoloji</h3><p>Bilgisayar, telefon</p></a>
    <a class="cat-card" href="search.html?cat=mobilya"><div class="ico">🛋️</div><h3>Mobilya</h3><p>Koltuk, masa, dolap</p></a>
  </div>

  <!-- FEED (boş ilan ortamı) -->
  <section class="feed">
    <h2 id="sharedListings">Paylaşılan İlanlar</h2>
    <p>Henüz ilan bulunmamaktadır. Yeni ilanlar eklendikçe burada görünecek.</p>
  </section>

  <!-- INFO -->
  <div class="info">
    <div class="info-card"><div class="in"><h3>✅ Güvenli Takas</h3><p>SSL ve KVKK güvencesiyle güvenli işlemler.</p></div></div>
    <div class="info-card"><div class="in"><h3>📱 Kolay Kullanım</h3><p>Mobil uyumlu arayüz ile her yerde ilan ver.</p></div></div>
    <div class="info-card"><div class="in"><h3>💬 Canlı Destek</h3><p>7/24 destek ekibi seninle.</p></div></div>
  </div>
</div>

<!-- FOOTER (renkli kutular) -->
<footer>
  <div class="wrap">
    <div class="footer-cols">
      <div class="footer-box kvkk">
        <h3>KVKK</h3>
        <ul>
          <li>Veri sorumlusu: Takas Çemberi A.Ş.</li>
          <li>Toplanan veriler: Ad, iletişim, işlem kayıtları.</li>
          <li>Amaç: Üyelik, güvenli takas, müşteri desteği.</li>
          <li>Haklarınız: Bilgi alma, düzeltme, silme, itiraz.</li>
        </ul>
      </div>
      <div class="footer-box gizlilik">
        <h3>Gizlilik</h3>
        <ul>
          <li>Çerez kullanımı ve tercih yönetimi.</li>
          <li>Üçüncü taraflarla paylaşım ilkeleri.</li>
          <li>Veri saklama süreleri ve şifreleme.</li>
        </ul>
      </div>
      <div class="footer-box guvenlik">
        <h3>Güvenlik</h3>
        <ul>
          <li>SSL/TLS ile şifreli bağlantı.</li>
          <li>2FA ve anormal aktivite izleme.</li>
          <li>İçerik moderasyonu ve raporlama.</li>
        </ul>
      </div>
      <div class="footer-box ssl">
        <h3>SSL Bilgisi</h3>
        <ul>
          <li>Modern protokoller (TLS 1.3) desteği.</li>
          <li>Güncel sertifika ve HSTS uygulanması.</li>
          <li>Güvenli çerçeve ve CORS politikaları.</li>
        </ul>
      </div>
      <div class="footer-box kullanim">
        <h3>Kullanım Şartları</h3>
        <ul>
          <li>İlan kuralları ve yasaklı içerikler.</li>
          <li>Üyelik sorumlulukları ve fesih.</li>
          <li>Uyuşmazlık ve yetkili yargı mercii.</li>
        </ul>
      </div>
    </div>
    <div style="margin-top:12px;color:var(--muted);font-size:14px">© 2025 Takas Çemberi — milli sermayeyi koru, atığı azalt ♻️</div>
  </div>
</footer>

<!-- BOTTOM NAV (mobile) -->
<nav class="bottomnav" aria-label="Alt menü">
  <a href="home.html" class="active" aria-label="Ana sayfa">🏠<small>Ana sayfa</small></a>
  <a href="messages.html" aria-label="Mesajlar">💬<small>Mesajlar</small></a>
  <a href="#" aria-label="Bildirimler" class="nav-bildir">🔔<small>Bildirimler</small></a>
</nav>

<!-- CANLI DESTEK BALONU -->
<div class="chatfab">
  <div class="fab-label">💬 Canlı Destek</div>
  <button class="fab" id="openChat" title="Canlı Destek">💬</button>
</div>
<div class="chatwin" id="chatWin" role="dialog" aria-modal="true" aria-labelledby="chatHd">
  <div class="hd"><b id="chatHd">Canlı Destek</b> <button id="chatClose" class="btn" style="padding:6px 10px;margin-left:auto">✕</button></div>
  <div class="bd" id="chatBody">
    <div class="msg">Merhaba, Takas Çemberi canlı desteğe hoş geldiniz 👋</div>
  </div>
  <div class="ft">
    <input id="chatInput" type="text" placeholder="Mesajınızı yazın...">
    <button id="chatSend">Gönder</button>
  </div>
</div>

<!-- SAYFA BETİKLERİ -->
<script type="module">
  // Firebase Auth + Firestore (kullanıcı adı)
  import { auth, db } from './js/firebase-config.js';
  import { onAuthStateChanged, signOut, setPersistence, browserLocalPersistence } from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js';
  import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js';

  // Oturumu kalıcı yap
  (async () => { try { await setPersistence(auth, browserLocalPersistence); } catch(_) {} })();

  const mobMenuBtn = document.getElementById('mobMenuBtn');
  const mobMenu = document.getElementById('mobMenu');
  const mobileUsername = document.getElementById('mobileUsername');

  function closeMobMenu(){ if(mobMenu){ mobMenu.style.display='none'; mobMenuBtn?.setAttribute('aria-expanded','false'); } }
  function toggleMobMenu(){ if(!mobMenu) return; const open = getComputedStyle(mobMenu).display !== 'none'; mobMenu.style.display = open? 'none':'block'; mobMenuBtn?.setAttribute('aria-expanded', open? 'false':'true'); }

  mobMenuBtn?.addEventListener('click', (e)=>{ e.stopPropagation(); toggleMobMenu(); });
  document.addEventListener('click', (e)=>{ if(!mobMenu) return; if(!mobMenu.contains(e.target) && e.target !== mobMenuBtn){ closeMobMenu(); } });

  // Oturum kontrolü ve kullanıcı adı
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      location.href = 'auth.html?next=home.html';
      return;
    }
    try {
      const snap = await getDoc(doc(db, 'users', user.uid));
      const data = snap.exists() ? snap.data() : {};
      const uname = data.username || (user.email ? user.email.split('@')[0] : 'kullanici');
      if (mobileUsername) mobileUsername.textContent = '@' + uname;
    } catch (_) {
      if (mobileUsername) mobileUsername.textContent = '@kullanici';
    }
  });

  // Çıkış (hem desktop, hem mobil dropdown)
  document.querySelectorAll('[data-logout]').forEach(el=>{
    el.addEventListener('click', async (e)=>{
      e.preventDefault();
      try { await signOut(auth); } catch(_) {}
      location.href = 'index.html';
    });
  });
</script>

<script>
  // Basit chat aç/kapat
  const chatBtn = document.getElementById('openChat');
  const chatWin = document.getElementById('chatWin');
  const chatClose = document.getElementById('chatClose');
  const chatSend = document.getElementById('chatSend');
  const chatInput = document.getElementById('chatInput');
  const chatBody = document.getElementById('chatBody');

  if (chatBtn && chatWin) chatBtn.onclick = () => { chatWin.style.display = 'flex'; };
  if (chatClose) chatClose.onclick = () => { chatWin.style.display = 'none'; };
  if (chatSend) chatSend.onclick = () => {
    const v = (chatInput.value || '').trim();
    if (!v) return;
    const div = document.createElement('div');
    div.className = 'msg me';
    div.textContent = v;
    chatBody.appendChild(div);
    chatInput.value='';
    chatBody.scrollTop = chatBody.scrollHeight;
  };
</script>
<script>document.addEventListener("DOMContentLoaded",function(){
  function blockOf(h){ return h ? (h.closest("section,article,div,main")||h) : null; }
  var shH = document.getElementById("sharedListings");
  var caH = document.getElementById("categories");
  var sh = blockOf(shH), ca = blockOf(caH);
  if(sh && ca && sh!==ca && ca.parentNode){ ca.parentNode.insertBefore(sh, ca); }
});</script>
  <script src="/assets/js/sound.js?v=1757853711"></script>
<script> 
  // başlangıçta ses açık (true) 
  window.setSoundEnabled = window.setSoundEnabled || function(v){ localStorage.setItem("sound.enabled", JSON.stringify(!!v)); }; 
  window.isSoundEnabled = window.isSoundEnabled || function(){ return JSON.parse(localStorage.getItem("sound.enabled") ?? "true"); }; 
  console.log("[sound] mevcut durum:", window.isSoundEnabled()); 
  // örnek: kapat -> setSoundEnabled(false); aç -> setSoundEnabled(true) 
</script>
<script type="module">import { startUserNotifications } from "/assets/js/bildirimler.js"; startUserNotifications();</script>
<section class="home-share" id="feed-wrap">
  <h2>Paylaşılan İlanlar</h2>
  <div id="feed-empty" class="sub" style="padding:12px">Henüz ilan bulunmamaktadır. Yeni ilanlar eklendikçe burada görünecek.</div>
  <div id="feed" class="grid"></div>
</section>
<script type="module" src="/js/home-feed.js"></script>
<script type="module" src="/assets/js/notify-bell.js"></script>
<script>document.addEventListener("click",function(e){var a=e.target.closest&&e.target.closest("a.nav-bildir");if(a){e.preventDefault();try{window.dispatchEvent(new CustomEvent("tc:bell:toggle"));}catch(_){}}});</script>
</body>
</html>
