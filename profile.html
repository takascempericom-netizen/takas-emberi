<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Profil ‚Ä¢ Takas √áemberi</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#0b1221; --bg2:#0a2439; --bg3:#062a2f;
      --panel:#0d1117; --panelInner:#0f141b; --line:#202635;
      --fg:#e8edf3; --muted:#98a6b8; --pri:#38bdf8; --ok:#22c55e; --bad:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--fg); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(60% 80% at 10% 10%, var(--bg2), transparent 70%),
        radial-gradient(70% 90% at 90% 0%, var(--bg3), transparent 70%),
        linear-gradient(140deg, var(--bg1), var(--bg2) 50%, var(--bg3));
      background-attachment: fixed;
      padding-bottom:90px; /* alt bar i√ßin bo≈üluk */
    }
    .wrap{max-width:1120px;margin:26px auto;padding:0 16px}
    .glowwrap{position:relative;border-radius:18px;padding:2px;overflow:visible}
    .glowwrap::before{
      content:""; position:absolute; inset:-2px; border-radius:20px;
      background:conic-gradient(from 0deg,#7dd3fc,#22c55e,#f59e0b,#7dd3fc);
      filter: blur(8px); opacity:.8; z-index:0; animation:hue 6s linear infinite;
    }
    .card{position:relative; z-index:1; background:var(--panel);
      border:1px solid var(--line); border-radius:18px; overflow:hidden;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    @keyframes hue { to { filter: hue-rotate(360deg) blur(8px); } }
    .hdr{display:flex;align-items:center;gap:16px;padding:16px 18px;border-bottom:1px solid var(--line)}
    .avatar{width:70px;height:70px;border-radius:50%;display:grid;place-items:center;overflow:hidden;border:1px solid var(--line);background:#0e1623}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .avatar-initial{font-weight:800;font-size:30px;display:grid;place-items:center;width:100%;height:100%;
      background:conic-gradient(from 45deg,#7dd3fc,#a78bfa,#fda4af,#7dd3fc); color:#0a0a0a}
    .meta{display:flex;flex-direction:column}
    .name{font-weight:800;font-size:18px}
    .uid{font-size:12px;color:var(--muted)}
    .actions{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--line);background:#0f1624;color:#e5eef7;border-radius:10px;padding:9px 12px;font-weight:800;cursor:pointer}
    .btn-pri{background:var(--pri);color:#00111a;border-color:transparent}
    .btn-warn{background:#111827;color:#fca5a5;border-color:#ef4444}
    .info{display:grid;grid-template-columns:2fr 3fr;gap:14px;padding:14px 16px;border-bottom:1px solid var(--line)}
    .ibox{background:var(--panelInner);border:1px solid var(--line);border-radius:14px;padding:12px}
    .ibox h3{margin:0 0 8px;font-size:13px;color:#cbd5e1}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="text"],input[type="email"],input[type="password"]{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#0c1220;color:#fff}
    .tabs{display:flex;gap:10px;align-items:center;padding:12px 16px;border-bottom:1px solid var(--line)}
    .tab{padding:8px 12px;border-radius:12px;cursor:pointer;font-weight:800;color:#cbd5e1}
    .tab.active{background:#101828;color:#fff}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px;padding:16px}
    @media (max-width:1024px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
    .cardL{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#0b111b}
    .ph{height:180px;background:#0a0f19;display:grid;place-items:center}
    .ph img{width:100%;height:100%;object-fit:cover}
    .body{padding:12px}
    .title{font-size:15px;font-weight:800;margin:0 0 6px}
    .muted{color:var(--muted);font-size:12px}
    .ops{display:flex;gap:8px;margin-top:10px}
    .ops .btn{padding:8px 10px;font-weight:700}
    .note{display:none;margin:6px 16px 0;color:#cbd5e1}
    .stat{padding:10px 16px;border-top:1px solid var(--line);font-size:12px;color:var(--muted)}
    #gate{padding:10px 16px;color:#f59e0b;display:none}
    /* Alt bar */
    .bottom-nav{position:fixed;left:50%;transform:translateX(-50%);bottom:12px;width:min(980px,calc(100% - 24px));
      background:rgba(9,12,18,.82);backdrop-filter:blur(10px);border:1px solid #1f2937;border-radius:16px;padding:8px;
      display:grid;grid-template-columns:repeat(4,1fr);gap:8px;z-index:50}
    .bn-item{display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 8px;border-radius:12px;
      text-decoration:none;color:#dbe2ea;font-weight:800}
    .bn-item.active{background:var(--pri);color:#00111a}
    .bn-ico{font-size:18px}
    .bn-badge{min-width:18px;height:18px;padding:0 6px;border-radius:999px;font-size:11px;font-weight:800;
      background:#ef4444;color:#fff;display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="glowwrap">
      <div class="card">
        <div class="hdr">
          <div class="avatar"><div class="avatar-initial" id="avatarInitial">U</div><img id="avatarImg" style="display:none"/></div>
          <div class="meta"><div class="name" id="profileName">Profil</div><div class="uid" id="profileUid">‚Äî</div></div>
          <div class="actions"><button class="btn" id="btnLogout" style="display:none">√áƒ±kƒ±≈ü</button><button class="btn-pri" id="btnGoogle" style="display:none">Google ile Giri≈ü</button></div>
        </div>
        <div class="info">
          <div class="ibox"><h3>Kullanƒ±cƒ± Bilgileri</h3>
            <div class="row">
              <div><label>ƒ∞sim</label><input id="f_displayName" type="text"></div>
              <div><label>Kullanƒ±cƒ± Adƒ±</label><input id="f_username" type="text"></div>
              <div><label>E-posta</label><input id="f_email" type="email" disabled></div>
              <div><label>≈ûifre</label><button class="btn" id="btnSendReset" style="width:100%">Sƒ±fƒ±rlama E-postasƒ±</button></div>
            </div>
          </div>
        </div>
        <div id="gate">Giri≈ü yapƒ±n veya ?uid= ekleyin.</div>
        <div class="tabs">
          <div class="tab active" data-tab="pub">Yayƒ±nda <span id="cntPub">0</span></div>
          <div class="tab" data-tab="pend">Onay Bekleyen <span id="cntPend">0</span></div>
          <div class="tab" data-tab="exp">S√ºresi Dolan <span id="cntExp">0</span></div>
        </div>
        <div class="note" id="note">ƒ∞lanlar y√ºkleniyor‚Ä¶</div>
        <div class="grid" id="list"></div>
        <div class="stat" id="stat">‚Äî</div>
      </div>
    </div>
  </div>
  <!-- Alt bar -->
  <nav class="bottom-nav">
    <a class="bn-item" href="/home.html" data-nav="home"><span class="bn-ico">üè†</span><span>Ana Sayfa</span></a>
    <a class="bn-item" href="/messages.html" data-nav="messages"><span class="bn-ico">üí¨</span><span>Mesajlar</span></a>
    <a class="bn-item" href="/notifications.html" data-nav="notifications"><span class="bn-ico">üîî</span><span>Bildiriler</span><span id="bnBadge" class="bn-badge">0</span></a>
    <a class="bn-item active" href="/profile.html" data-nav="profile"><span class="bn-ico">üë§</span><span>Profil</span></a>
  </nav>
<script type="module">
  import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, getDocs, collection, query, where, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  const cfg={apiKey:"AIzaSyBUUNSYxoWNUsK0C-C04qTUm6fvg",authDomain:"ureten-eller-v2.firebaseapp.com",projectId:"ureten-eller-v2",storageBucket:"ureten-eller-v2.firebasestorage.app",messagingSenderId:"621494781131",appId:"1:621494781131:web:13cc3b061a5e94b7cf874e"};
  const app=(getApps().length?getApp():initializeApp(cfg));const auth=getAuth(app);const db=getFirestore(app);
  const $=s=>document.querySelector(s),$$=s=>Array.from(document.querySelectorAll(s));
  const avatarImg=$("#avatarImg"),avatarInitial=$("#avatarInitial"),nameEl=$("#profileName"),uidEl=$("#profileUid"),
        f_displayName=$("#f_displayName"),f_username=$("#f_username"),f_email=$("#f_email"),
        cntPub=$("#cntPub"),cntPend=$("#cntPend"),cntExp=$("#cntExp"),listEl=$("#list"),note=$("#note"),stat=$("#stat"),
        btnLogout=$("#btnLogout"),btnGoogle=$("#btnGoogle"),btnSendReset=$("#btnSendReset");
  const provider=new GoogleAuthProvider();
  function showAvatar(u){ if(u?.photoURL){avatarImg.src=u.photoURL;avatarImg.style.display="block";avatarInitial.style.display="none";} else {avatarInitial.textContent=(u?.displayName||u?.email||"U")[0].toUpperCase();avatarInitial.style.display="grid";avatarImg.style.display="none";}}
  function classify(d){const now=Date.now();const s=(d?.status||"").toLowerCase();const approved=["approved","active","yayƒ±nda","yayinda","published"].includes(s)||d?.approved===true;const expired=d?.expiresAt && d.expiresAt.toMillis?d.expiresAt.toMillis()<now:false;const pending=!approved&&!expired;return {approved,pending,expired};}
  function render(items,isOwner){
  listEl.innerHTML = "";
  items.forEach(it=>{
    const c = classify(it);
    const show = (ACTIVE==="pub"  && c.approved && !c.expired) ||
                 (ACTIVE==="pend" && c.pending) ||
                 (ACTIVE==="exp"  && c.expired);
    if(!show) return;

    const el = document.createElement("div");
    el.className = "cardL";

    const imgHTML = it.imageURL
      ? ('<img src="'+ String(it.imageURL) +'" alt="">')
      : '<span class="muted">G√∂rsel yok</span>';

    el.innerHTML = `
      <div class="ph">${imgHTML}</div>
      <div class="body">
        <div class="title">${it.title || "ƒ∞lan"}</div>
        <div class="muted">${it.category || ""}</div>
        ${isOwner ? `
        <div class="ops">
          <button class="btn" data-edit="${it.id}">D√ºzenle</button>
          <button class="btn btn-warn" data-del="${it.id}">Sil</button>
        </div>` : ``}
      </div>
    `;

    if(isOwner){
      const eBtn = el.querySelector('[data-edit]');
      const dBtn = el.querySelector('[data-del]');
      if(eBtn) eBtn.onclick = ()=> location.href = "/listing-edit.html?id=" + encodeURIComponent(it.id);
      if(dBtn) dBtn.onclick = async ()=>{
        if(confirm("Bu ilan silinsin mi?")){
          try{ await deleteDoc(doc(db,"listings", String(it.id))); }catch(e){ alert("Silme hatasƒ±: "+(e?.message||e)); }
        }
      };
    }

    listEl.appendChild(el);
  });

  stat.textContent = items.length + " kayƒ±t.";
}
  let ACTIVE="pub";$$(".tab").forEach(t=>t.onclick=()=>{$$(".tab").forEach(x=>x.classList.remove("active"));t.classList.add("active");ACTIVE=t.dataset.tab;load();});
  let USER=null;let UID=null;
  async function load(){note.style.display="block";const items=[];try{const c=collection(db,"listings");const qs=[query(c,where("ownerId","==",UID)),query(c,where("uid","==",UID)),query(c,where("userId","==",UID))];for(const q of qs){const snap=await getDocs(q);snap.forEach(d=>items.push({id:d.id,...d.data()}));}}catch(e){console.warn("listeleme",e)}const map=new Map();for(const it of items){map.set(it.id,it)}const arr=[...map.values()];cntPub.textContent=arr.filter(x=>{const c=classify(x);return c.approved&&!c.expired}).length;cntPend.textContent=arr.filter(x=>{const c=classify(x);return c.pending&&!c.approved&&!c.expired}).length;cntExp.textContent=arr.filter(x=>classify(x).expired).length;note.style.display="none";render(arr,USER&&USER.uid===UID);
  console.log("[profile] UID=",UID," pub=",document.getElementById("cntPub").textContent," pend=",document.getElementById("cntPend").textContent," exp=",document.getElementById("cntExp").textContent);
}
  onAuthStateChanged(auth,u=>{USER=u;UID=u?.uid||null;if(u){nameEl.textContent=u.displayName||u.email;uidEl.textContent=u.uid;f_displayName.value=u.displayName||"";f_email.value=u.email||"";showAvatar(u);btnLogout.style.display="inline-block";btnGoogle.style.display="none";}else{btnLogout.style.display="none";btnGoogle.style.display="inline-block";}load();});
  btnGoogle.onclick=()=>signInWithPopup(auth,provider);btnLogout.onclick=()=>signOut(auth);btnSendReset.onclick=()=>USER?.email&&sendPasswordResetEmail(auth,USER.email);
</script>
</body>
</html>
