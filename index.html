<!-- /index.html -->
<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Takas Çemberi • Giriş / Kayıt</title>
  <link rel="icon" href="/assets/img/seffaf.png">
  <meta name="color-scheme" content="light dark" />

  <style>
    :root{
      --bg:#ffffff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb;
      --brandA:#6a5cff; --brandB:#00d4ff; --focus:#0ea5e9;
      --c1:#6d28d9; --c2:#2563eb; --c3:#0891b2; --c4:#db2777;
      --paper:#ffffff; --paper2:#f8fafc; --btn:#111827; --btnInk:#fff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      overflow-x:hidden; /* taşmayı kesin kes kapat */
    }
    img,svg{max-width:100%; height:auto; display:block}

    /* Top bar (wrap destekli – taşma yok) */
    .topbar{
      position:sticky; top:0; z-index:100;
      display:flex; align-items:center; gap:12px; flex-wrap:wrap;
      min-height:64px;
      background:linear-gradient(90deg,var(--brandA),var(--brandB));
      background-size:200% 200%; animation:barShift 8s ease-in-out infinite;
      padding:8px 12px; box-shadow:0 2px 14px rgba(10,20,60,.18);
      border-bottom:1px solid rgba(0,0,0,.06)
    }
    @keyframes barShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .brand img{height:clamp(40px,9vw,56px); filter:drop-shadow(0 2px 6px rgba(0,0,0,.25))}
    .grow{flex:1 1 auto; min-width:20px}
    .btn{border:0;border-radius:14px;padding:10px 14px;font-weight:700;cursor:pointer;white-space:nowrap}
    .btn.primary{background:var(--btn);color:var(--btnInk)}
    .btn.ghost{background:rgba(255,255,255,.14);color:#fff;border:1px solid rgba(255,255,255,.28)}
    .btn:focus{outline:2px solid var(--focus);outline-offset:2px}
    @media (max-width:380px){
      /* en dar ekranda butonlar küçülür, yine de taşmaz */
      .btn{padding:8px 10px;font-size:13px}
    }

    /* Hero */
    .hero{max-width:1100px;margin:24px auto;padding:16px}
    .panel{
      background:linear-gradient(270deg,var(--c1),var(--c2),var(--c3),var(--c4));
      background-size:800% 800%; animation:panelBG 16s ease infinite;
      border-radius:20px; padding:24px; box-shadow:0 10px 40px rgba(5,10,30,.12);
      color:#fff; text-align:center; border:1px solid #eef2ff
    }
    @keyframes panelBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

    .hero-logo{
      width:clamp(120px,28vw,220px); margin:0 auto 12px;
      filter:drop-shadow(0 2px 6px rgba(0,0,0,.25))
    }
    .title{
      font-size:clamp(32px,6vw,56px); font-weight:900; margin:0 0 12px;
      text-shadow:0 1px 14px rgba(0,0,0,.25)
    }
    .subtitle{font-size:clamp(16px,3.2vw,20px); margin:0 0 6px; opacity:.98}

    .slogan-panel{
      margin:20px auto; max-width:900px; padding:20px;
      border-radius:20px; text-align:center; color:#0f172a;
      background:#ffffff; border:1px solid var(--line);
      box-shadow:0 4px 30px rgba(0,0,0,.06)
    }
    .slogan-rotator{font-size:clamp(16px,3.5vw,22px); font-weight:800; min-height:2.2em; transition:opacity .35s ease}

    /* Kategoriler */
    .cats{background:var(--paper); border:1px solid var(--line); border-radius:20px; padding:16px; color:var(--ink)}
    .cats h2{margin:0 0 12px}
    .grid{display:grid; gap:12px; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); margin-top:12px}
    .card{
      border-radius:18px; padding:16px; min-height:120px;
      display:flex; flex-direction:column; gap:6px; align-items:center; justify-content:center;
      color:#fff; animation:cardColors 20s infinite alternate ease-in-out; background:var(--c1);
      transition:transform .18s,border-color .2s; border:1px solid rgba(0,0,0,.06)
    }
    .card:hover{transform:translateY(-6px)}
    @keyframes cardColors{
      0%{background:var(--c1)}25%{background:var(--c2)}50%{background:var(--c3)}75%{background:var(--c4)}100%{background:var(--c1)}
    }
    .emoji{font-size:26px}

    .features{display:grid; gap:12px; margin-top:16px; grid-template-columns:repeat(auto-fit,minmax(210px,1fr))}
    .feature{padding:12px; border-radius:14px; color:#0f172a; text-align:center; background:#fff; border:1px solid var(--line)}

    /* Dialoglar (tam responsive) */
    dialog{border:0;border-radius:16px;padding:0;max-width:95vw;background:var(--paper);color:var(--ink);border:1px solid var(--line); z-index:200;}
    dialog::backdrop{background:rgba(0,0,0,.45)}
    .modal{padding:16px; width:min(560px,95vw); position:relative}
    .in{width:100%;padding:12px 44px 12px 12px;border-radius:12px;border:1px solid var(--line);margin-bottom:10px;font-size:16px;background:var(--paper2);color:var(--ink)}
    .in:focus{outline:2px solid var(--focus);border-color:transparent}
    .x{position:absolute;top:10px;right:12px;background:transparent;border:0;font-size:22px;cursor:pointer;color:#64748b}
    .field{position:relative}
    .toggle{position:absolute;right:10px;top:50%;transform:translateY(-50%);border:0;background:transparent;color:#64748b;cursor:pointer;font-size:13px}
    .row{display:flex;gap:10px; flex-wrap:wrap}
    .row > *{flex:1 1 220px; min-width:0}

    .legal-ack{
      display:flex;gap:10px;align-items:flex-start;background:#f8fafc;border:1px solid var(--line);
      padding:10px;border-radius:12px;margin-top:6px
    }
    .legal-ack label{line-height:1.4}
    .legal-ack a{color:#2563eb;text-decoration:none}
    .legal-ack a:hover{text-decoration:underline}

    /* Footer */
    footer{border-top:1px solid var(--line); margin-top:30px}
    .foot-wrap{
      max-width:1100px; margin:0 auto; padding:12px 16px; color:var(--muted);
      display:flex; gap:12px; align-items:center; flex-wrap:wrap
    }
    .foot-logo{height:clamp(20px,4vw,28px)}
    .foot-links{display:flex; gap:12px; flex-wrap:wrap}
    .foot-links a{color:var(--muted); text-decoration:none}
    .foot-links a:hover{text-decoration:underline}
  </style>
</head>

<body>
  <!-- Üst çubuk -->
  <header class="topbar">
    <a class="brand" href="/"><img src="/assets/img/seffaf.png" alt="Takas Çemberi"/></a>
    <div class="grow"></div>
    <button class="btn ghost" id="btnLoginOpen">Giriş Yap</button>
    <button class="btn primary" id="btnSignupOpen">Kaydol</button>
    <button class="btn ghost" id="btnLogout" style="display:none">Çıkış</button>
  </header>

  <!-- İçerik -->
  <main class="hero">
    <section class="panel" aria-labelledby="welcome-title">
      <img class="hero-logo" src="/assets/img/seffaf.png" alt="Takas Çemberi logo">
      <h1 id="welcome-title" class="title">Takas Çemberi’ne Hoş Geldiniz</h1>
      <p class="subtitle">Toplulukla takas et, eşyana yeni bir hayat ver.</p>
    </section>

    <section class="slogan-panel" aria-hidden="false">
      <div class="slogan-rotator" id="slogan" aria-live="polite"></div>
    </section>

    <section class="cats" aria-labelledby="cats-title" style="margin-top:12px">
      <h2 id="cats-title" style="margin-bottom:12px">Kategoriler</h2>
      <div class="grid" role="list">
        <div class="card" role="listitem"><div class="emoji">🏠</div><h3>Ev & Hobi</h3><p>Ev eşyaları, hobi ürünleri</p></div>
        <div class="card" role="listitem"><div class="emoji">🏡</div><h3>Taşınmaz</h3><p>Ev, arsa, tarla</p></div>
        <div class="card" role="listitem"><div class="emoji">🚗</div><h3>Motorlu Taşıtlar</h3><p>Araba, motosiklet, yedek parça</p></div>
        <div class="card" role="listitem"><div class="emoji">🧸</div><h3>Oyuncak</h3><p>Her yaşa uygun oyuncaklar</p></div>
        <div class="card" role="listitem"><div class="emoji">👗</div><h3>Giyim</h3><p>Kadın, erkek, çocuk</p></div>
        <div class="card" role="listitem"><div class="emoji">⚡</div><h3>Beyaz Eşya</h3><p>Ev aletleri, mutfak</p></div>
        <div class="card" role="listitem"><div class="emoji">💻</div><h3>Teknoloji</h3><p>Bilgisayar, telefon</p></div>
        <div class="card" role="listitem"><div class="emoji">🛋️</div><h3>Mobilya</h3><p>Koltuk, masa, dolap</p></div>
      </div>

      <div class="features" style="margin-top:16px">
        <div class="feature">✅ Güvenli Takas<br/>SSL ve KVKK güvencesiyle güvenli işlemler.</div>
        <div class="feature">📱 Kolay Kullanım<br/>Mobil uyumlu arayüz ile her yerde ilan ver.</div>
        <div class="feature">💬 Canlı Destek<br/>7/24 destek ekibi seninle.</div>
      </div>
    </section>
  </main>

  <!-- Alt bilgi -->
  <footer>
    <div class="foot-wrap">
      <img class="foot-logo" src="/assets/img/legallogo.png" alt="Takas Çemberi yasal logo">
      <nav class="foot-links" aria-label="Yasal bağlantılar">
        <a href="/legal/hakkimizda.html">Hakkımızda</a>
        <a href="/legal/gizlilik.html">Gizlilik</a>
        <a href="/legal/teslimat-iade.html">Teslimat &amp; İade</a>
        <a href="/legal/mesafeli-satis-sozlesmesi.html">Mesafeli Satış</a>
        <a href="/legal/kullanim-sartlari.html">Kullanım Şartları</a>
        <a href="/legal/kvkk.html">KVKK</a>
        <a href="/legal/iletisim.html">İletişim &amp; Ticari</a>
      </nav>
      <div class="grow"></div>
      <small>© 2025 Takas Çemberi • takascemberi.com</small>
    </div>
  </footer>

  <!-- MODALLAR: Giriş / Kayıt -->
  <dialog id="dlgLogin" aria-modal="true" role="dialog">
    <form method="dialog" class="modal">
      <button class="x" value="close" aria-label="Kapat" onclick="this.closest('dialog').close()">✕</button>
      <h3 style="margin:0 0 12px">Giriş Yap</h3>

      <button type="button" class="btn primary" id="btnGoogleLogin" style="width:100%;margin-bottom:10px">Google ile Giriş</button>
      <div style="display:flex;align-items:center;gap:10px;margin:8px 0">
        <span style="flex:1;height:1px;background:#e5e7eb"></span>
        <small style="color:#64748b">veya e-posta ile</small>
        <span style="flex:1;height:1px;background:#e5e7eb"></span>
      </div>

      <input class="in" type="email" id="loginEmail" placeholder="E-posta" required />
      <div class="field">
        <input class="in" type="password" id="loginPass" placeholder="Şifre" required />
        <button type="button" class="toggle" data-target="loginPass">Göster</button>
      </div>
      <button type="button" class="btn primary" id="btnEmailLogin" style="width:100%;margin-top:8px">Giriş Yap</button>

      <div style="text-align:center;margin-top:8px">
        <button type="button" id="btnForgot" style="background:none;border:0;color:#2563eb;font-weight:700;cursor:pointer">Şifremi Unuttum</button>
        <button type="button" id="btnResendVerify" style="background:none;border:0;color:#059669;font-weight:700;cursor:pointer">Doğrulama Mailini Tekrar Gönder</button>
      </div>
    </form>
  </dialog>

  <dialog id="dlgSignup" aria-modal="true" role="dialog">
    <form method="dialog" class="modal">
      <button class="x" value="close" aria-label="Kapat" onclick="this.closest('dialog').close()">✕</button>
      <h3 style="margin:0 0 12px">Kaydol</h3>

      <button type="button" class="btn primary" id="btnGoogleSignup" style="width:100%;margin-bottom:10px">Google ile Devam Et</button>
      <div style="display:flex;align-items:center;gap:10px;margin:8px 0">
        <span style="flex:1;height:1px;background:#e5e7eb"></span>
        <small style="color:#64748b">veya formu doldur</small>
        <span style="flex:1;height:1px;background:#e5e7eb"></span>
      </div>

      <div class="row">
        <input class="in" type="text" id="firstName" placeholder="İsim" required />
        <input class="in" type="text" id="lastName" placeholder="Soyisim" required />
      </div>
      <div class="row">
        <input class="in" type="text" id="city" placeholder="Yaşadığı Şehir" required />
        <input class="in" type="text" id="username" placeholder="Kullanıcı Adı" required />
      </div>
      <input class="in" type="email" id="email" placeholder="E-posta" required />
      <div class="row">
        <div class="field">
          <input class="in" type="password" id="pass1" placeholder="Şifre" required />
          <button type="button" class="toggle" data-target="pass1">Göster</button>
        </div>
        <div class="field">
          <input class="in" type="password" id="pass2" placeholder="Şifre (tekrar)" required />
          <button type="button" class="toggle" data-target="pass2">Göster</button>
        </div>
      </div>

      <!-- KVKK & Gizlilik onay kutuları -->
      <div class="legal-ack">
        <input id="ackKvkk" type="checkbox" style="margin-top:3px">
        <label for="ackKvkk">
          <a href="/legal/kvkk.html" target="_blank" rel="noopener">KVKK Aydınlatma Metni</a>’ni okudum ve kabul ediyorum.
        </label>
      </div>
      <div class="legal-ack">
        <input id="ackPrivacy" type="checkbox" style="margin-top:3px">
        <label for="ackPrivacy">
          <a href="/legal/gizlilik.html" target="_blank" rel="noopener">Gizlilik Politikası</a>’nı okudum ve kabul ediyorum.
        </label>
      </div>

      <button type="button" class="btn primary" id="btnEmailSignup" style="width:100%;margin-top:10px" disabled>Kaydol</button>
    </form>
  </dialog>

  <script type="module">
    import { initializeApp, getApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth, setPersistence, browserLocalPersistence, indexedDBLocalPersistence,
      signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider,
      createUserWithEmailAndPassword, updateProfile,
      sendPasswordResetEmail, sendEmailVerification, signOut, onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    /* ===== Firebase ===== */
    const firebaseConfig = {
      apiKey: "AIzaSyBUUNSYxoWNUsK0C-C04qTUm6KM5756fvg",
      authDomain: "auth.takascemberi.com",
      projectId: "ureten-eller-v2",
      storageBucket: "ureten-eller-v2.appspot.com",
      messagingSenderId: "621494781131",
      appId: "1:621494781131:web:13cc3b061a5e94b7cf874e"
    };
    const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
    const auth = getAuth(app);

    try { await setPersistence(auth, indexedDBLocalPersistence); }
    catch { await setPersistence(auth, browserLocalPersistence); }

    const $ = (sel, root=document) => root.querySelector(sel);

    /* ===== Slogan rotator (15 sn) ===== */
    const slogans = [
      "Evinizdeki eşyaları değerinde takas edin, atığı azaltın, birlikte kazanın.",
      "İhtiyacın olmayan başkasının hazinesi olabilir.",
      "Bütçe dostu takasla yeni başlangıçlar yap.",
      "Topluluk gücüyle sürdürülebilir alışveriş.",
      "Az tüket, çok paylaş: Takas Çemberi’ndesin."
    ];
    const sEl = $("#slogan");
    let sIdx = 0;
    function setSlogan(i){
      if(!sEl) return;
      sEl.style.opacity = 0;
      setTimeout(()=>{ sEl.textContent = slogans[i % slogans.length]; sEl.style.opacity = 1; }, 250);
    }
    setSlogan(sIdx++);
    setInterval(()=>setSlogan(sIdx++), 15000);

    /* ===== Dialog açma ===== */
    const openDlg = (sel) => {
      const d = $(sel);
      if (!d) return;
      if (typeof d.showModal === "function") d.showModal();
      else d.setAttribute("open", "");
    };
    $("#btnLoginOpen")?.addEventListener("click", ()=>openDlg("#dlgLogin"));
    $("#btnSignupOpen")?.addEventListener("click", ()=>openDlg("#dlgSignup"));

    /* ===== Şifre göster/gizle ===== */
    addEventListener("click",(e)=>{
      const t=e.target;
      if(t?.classList?.contains("toggle")){
        const id=t.getAttribute("data-target");
        const inp=$("#"+id);
        if(inp) inp.type = (inp.type==="password"?"text":"password");
      }
    });

    /* ===== KVKK & Gizlilik onay kontrolü ===== */
    const ackKvkk = $("#ackKvkk");
    const ackPrivacy = $("#ackPrivacy");
    const btnEmailSignup = $("#btnEmailSignup");
    function refreshSignupEnabled(){
      if (!btnEmailSignup) return;
      const ok = !!(ackKvkk?.checked && ackPrivacy?.checked);
      btnEmailSignup.disabled = !ok;
    }
    ackKvkk?.addEventListener("change", refreshSignupEnabled);
    ackPrivacy?.addEventListener("change", refreshSignupEnabled);
    refreshSignupEnabled();

    /* ===== Google ile giriş/kayıt ===== */
    const provider = new GoogleAuthProvider();
    async function googleLogin(){ await signInWithPopup(auth, provider); location.href="/home.html"; }
    $("#btnGoogleLogin")?.addEventListener("click", googleLogin);
    $("#btnGoogleSignup")?.addEventListener("click", googleLogin);

    /* ===== E-posta ile giriş ===== */
    $("#btnEmailLogin")?.addEventListener("click", async ()=>{
      const email = $("#loginEmail")?.value?.trim() || "";
      const pass  = $("#loginPass")?.value || "";
      if(!email || !pass) return;
      const { user } = await signInWithEmailAndPassword(auth, email, pass);
      if(!user.emailVerified){
        try{ await sendEmailVerification(user); }catch{}
        alert("E-postanı doğrulaman gerekiyor. Doğrulama linkini gönderdik. Gelen kutunu/SPAM’ı kontrol et.");
        try{ await signOut(auth); }catch{}
        return;
      }
      location.href="/home.html";
    });

    /* ===== Şifremi unuttum ===== */
    $("#btnForgot")?.addEventListener("click", async ()=>{
      let email = $("#loginEmail")?.value?.trim() || prompt("E-posta:") || "";
      if(!email) return;
      await sendPasswordResetEmail(auth, email);
      alert("Sıfırlama e-postası gönderildi: "+email);
    });

    /* ===== Doğrulama mailini tekrar gönder ===== */
    $("#btnResendVerify")?.addEventListener("click", async ()=>{
      const u = auth.currentUser;
      if(!u){ alert("Önce giriş yapmalısın."); return; }
      try{ await sendEmailVerification(u); alert("Doğrulama e-postası gönderildi."); }catch{ alert("Gönderilemedi."); }
    });

    /* ===== E-posta ile kayıt ===== */
    btnEmailSignup?.addEventListener("click", async ()=>{
      if(btnEmailSignup.disabled) { alert("KVKK ve Gizlilik onaylarını kabul etmelisin."); return; }

      const firstName = $("#firstName")?.value?.trim() || "";
      const lastName  = $("#lastName")?.value?.trim() || "";
      const city      = $("#city")?.value?.trim() || "";
      const username  = $("#username")?.value?.trim() || "";
      const email     = $("#email")?.value?.trim() || "";
      const p1        = $("#pass1")?.value || "";
      const p2        = $("#pass2")?.value || "";

      if(!firstName || !lastName || !city || !username || !email || !p1 || !p2){
        alert("Lütfen tüm alanları doldurun."); return;
      }
      if(p1 !== p2){ alert("Şifreler eşleşmiyor."); return; }
      if(p1.length < 6){ alert("Şifre en az 6 karakter olmalı."); return; }

      const { user } = await createUserWithEmailAndPassword(auth, email, p1);
      try{
        await updateProfile(user, { displayName: `${firstName} ${lastName}` });
        await sendEmailVerification(user);
        alert("Kayıt oluşturuldu. Doğrulama e-postasını kontrol edin.");
        await signOut(auth);
      }catch(e){
        console.warn(e);
      }
    });

    /* ===== Çıkış ===== */
    $("#btnLogout")?.addEventListener("click", async ()=>{
      try{ await signOut(auth); }catch{}
      location.href="/";
    });

    /* ===== Oturum durumu ===== */
    onAuthStateChanged(auth, (user)=>{
      const verified = !!user && (user.emailVerified || (user?.providerData||[]).some(p=>p.providerId==="google.com"));
      const logoutBtn = $("#btnLogout"); if(logoutBtn) logoutBtn.style.display = user ? "" : "none";
      if(verified){ location.replace("/home.html"); }
    });
  </script>
</body>
</html>
