<!doctype html><meta charset=utf-8><title>Kullanıcılar • Admin</title><link rel=stylesheet href="css/admin.css"><div class=top><h1>Kullanıcılar</h1><a class=btn href="home.html">← Admin Ana</a></div><div class=wrap><div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px"><input id=search placeholder="Ad/E-posta ara" style="padding:8px 10px;border-radius:10px;border:1px solid var(--line);background:#0f1420;color:#e6e8ee;min-width:240px"><button id=bulkDel class="btn reject">Seçili Sil</button><button id=bulkBan class="btn warn">Seçili Banla</button></div><table class=tbl id=tbl_users><thead><tr><th><input id=chkAll type=checkbox></th><th>Ad</th><th>E-posta</th><th>Rol</th><th>İşlem</th></tr></thead><tbody><tr><td colspan=5 class=muted>Yükleniyor…</td></tr></tbody></table></div><script>/* hafif loader: REST + filtre + toplu seçim */const PJ="ureten-eller-v2";const RUNQ=`https://firestore.googleapis.com/v1/projects/${PJ}/databases/(default)/documents:runQuery`;const DOC=`https://firestore.googleapis.com/v1/projects/${PJ}/databases/(default)/documents`;const q=b=>fetch(RUNQ,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)}).then(r=>r.json());const del=f=>fetch(f,{method:"DELETE"});const create=(p,fields)=>fetch(`${DOC}/${p}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fields})});const fStr=s=>({stringValue:String(s||"")});const fBool=b=>({booleanValue:!!b});let ROWS=[];function render(rows){const tb=document.querySelector("#tbl_users tbody");if(!rows.length){tb.innerHTML="<tr><td colspan=5 class=muted>Kullanıcı yok.</td></tr>";return}tb.innerHTML=rows.map(d=>{const f=d.fields||{},id=(d.name||"").split("/").pop();const name=(f.name&&f.name.stringValue)||id;const email=(f.email&&f.email.stringValue)||"-";const role=(f.role&&f.role.stringValue)||"-";return `<tr data-id="${id}" data-full="${d.name}"><td><input type=checkbox class=rowChk></td><td>${name}</td><td>${email}</td><td><span class=badge>${role}</span></td><td class=row-actions><a class=btn href="support.html" title="Mesajlarını Gör">Mesajlar</a><button class="btn warn ban">Banla</button><button class="btn reject del">Sil</button></td></tr>`}).join("");document.querySelector("#chkAll").onclick=e=>{tb.querySelectorAll(".rowChk").forEach(c=>c.checked=e.target.checked)};tb.querySelectorAll(".del").forEach(b=>b.onclick=()=>{const tr=b.closest("tr");if(confirm("Bu kullanıcı dokümanı silinsin mi?"))del(tr.dataset.full).then(()=>load())});tb.querySelectorAll(".ban").forEach(b=>b.onclick=()=>{const tr=b.closest("tr");create("bans",{uid:fStr(tr.dataset.id),active:fBool(true),reason:fStr("admin"),createdAt:{timestampValue:new Date().toISOString()}}).then(()=>alert("Banlandı"))})}function filter(){const qv=document.getElementById("search").value.trim().toLowerCase();if(!qv)return render(ROWS);render(ROWS.filter(d=>{const f=d.fields||{},id=(d.name||"").split("/").pop();const name=(f.name&&f.name.stringValue)||id;const email=(f.email&&f.email.stringValue)||"";return name.toLowerCase().includes(qv)||email.toLowerCase().includes(qv)}))}function bulk(act){const checked=[...document.querySelectorAll(".rowChk:checked")].map(c=>c.closest("tr"));if(!checked.length)return alert("Seçim yok");if(act==="del"&&!confirm(`${checked.length} kullanıcı silinsin mi?`))return;if(act==="ban"&&!confirm(`${checked.length} kullanıcı banlansın mı?`))return;Promise.all(checked.map(tr=>act==="del"?del(tr.dataset.full):create("bans",{uid:fStr(tr.dataset.id),active:fBool(true),reason:fStr("bulk"),createdAt:{timestampValue:new Date().toISOString()}}))).then(()=>{if(act==="del")load();else alert("Banlandı")})}function load(){const body={structuredQuery:{from:[{collectionId:"users"}],orderBy:[{field:{fieldPath:"createdAt"},direction:"DESCENDING"}],limit:200}};q(body).then(arr=>{ROWS=(arr||[]).filter(x=>x.document).map(x=>x.document);render(ROWS)})}document.getElementById("search").oninput=filter;document.getElementById("bulkDel").onclick=()=>bulk("del");document.getElementById("bulkBan").onclick=()=>bulk("ban");load();</script>