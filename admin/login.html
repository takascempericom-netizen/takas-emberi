<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin Giriş</title>
  <style>
    body{margin:0;display:grid;place-items:center;height:100dvh;font-family:Inter,system-ui}
    .card{width:min(380px,92vw);border:1px solid #e5e7eb;border-radius:14px;padding:16px}
    .row{display:grid;gap:8px}
    input,button{font:inherit;border:1px solid #e5e7eb;border-radius:10px;padding:10px}
    button{cursor:pointer;background:#111827;color:#fff;border-color:#111827}
    .muted{color:#64748b;font-size:12px}
  </style>
</head>
<body>
  <div class="card">
    <h2>Admin Girişi</h2>
    <div class="row">
      <input id="email" placeholder="admin@example.com" type="email"/>
      <input id="pass" placeholder="Şifre" type="password"/>
      <button id="btn">Giriş</button>
      <div id="msg" class="muted"></div>
    </div>
  </div>

  <script type="module">
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import "/assets/js/firebase-init.js";
    const { auth } = window.__fb || { auth: getAuth() };
    const msg = document.getElementById('msg');

    onAuthStateChanged(auth, async (u)=>{
      if(u){
        await u.getIdTokenResult(true);
        const claim = u.getIdTokenResult ? await u.getIdTokenResult() : {claims:{}};
        if(claim.claims?.admin || ['admin','moderator','support'].includes(claim.claims?.role)){
          location.href="/admin/";
        }else{
          msg.textContent = "Bu kullanıcı admin değil.";
        }
      }
    });

    document.getElementById('btn').onclick = async ()=>{
      msg.textContent = "Giriş yapılıyor…";
      try{
        const email = document.getElementById('email').value.trim();
        const pass  = document.getElementById('pass').value;
        await signInWithEmailAndPassword(auth, email, pass);
      }catch(e){ msg.textContent = e.code || e.message; }
    };
  </script>
</body>
</html>
